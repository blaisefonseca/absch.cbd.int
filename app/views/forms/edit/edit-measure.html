<div ng-controller="editMeasure" class="md-whiteframe-z1" >

    <div ng-include="'/app/views/forms/edit/edit_header.html'"></div>

    <md-content layout-padding style="padding: 24px;background-color:#FFF;border-bottom:2px solid #ccc;">

  <div class="registerpage-content">
    <div>
      <div class="alert alert-error" ng-show="hasError()">
        <strong>Error as occured...</strong>
        <div>{{error}}</div>
      </div>

      <div ng-show="isLoading()">
        <i class="fa fa-spinner fa-spin"></i> Loading...
      </div>

      <div ng-show="!isLoading() && status!='hidden'">
        <div workflow-std-buttons document="getCleanDocument()" languages="document.header.languages"  hide-timer="false"/>
            <div km-document-validation ng-model="validationReport"></div>

        <form class="editForm" name="editForm" style="margin-top:10px">
          <div ng-show="tab=='edit'" km-tab="edit">
            <legend name="formInfo" style="display:none"></legend>
          <section>
            <legend>Is this an amendment to previous legislative, administrative or policy measure? </legend>
            <div class="row">
              <div class="col-xs-12">
                <div class="km-control-group" name="isAmendment" required caption="Is this an amendment to previous legislative, administrative or policy measure? ">
                  <div class="help-block"></div>
                  <div km-yes-no required ng-model="document.isAmendment" locales="document.header.languages"></div>
                </div>
              </div>
            </div>

             <!-- IF NO SECTION -->
            <div ng-class="{'disable':!document.isAmendment, 'bg-white':document.isAmendment}" class="well no-shadow" style="padding-top:0;padding-bottom:0;" >
            <div class="row" >
              <div class="col-xs-12">
                <h3 ng-show="!document.isAmendment" style="color:black!important;">
                  If no, the following information is not required.
                </h3>
                <h3 ng-show="document.isAmendment==true" style="color:black!important;">
                  Please select the previously registered record that is being amended.
                </h3>

                <div class="km-control-group">
                    <div class="km-control-group" name="amendedMeasures" caption="List of amended measures">
                        <div class="help-block">Please indicate if this measure amends a previously registered one by providing a cross-reference link to the amended measure.</div>
                        <div km-select multiple name="amendedMeasures" ng-model="document.amendedMeasures"items="options.measures()" placeholder="Please select ..."></div>
                    </div>
                </div>

                <div class="km-control-group" name="amendmentsDescription" caption="Summary of the amendment(s)">
                  <div km-rich-textbox ng-model="document.amendmentsDescription" rows="4" locales="document.header.languages"></div>
                </div>

              </div>
            </div>
            </div>
          </section>


          <section>
            <legend>General information</legend>
            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="government" required caption="Country">

                  <div afc-autocomplete required name="government" ng-disabled="userGovernment()" ng-model="document.government" source="options.countries" filter="genericFilter" mapping="genericMapping" selectbox="true" placeholder="Please select a country..."></div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" required name="title" caption="Title of the legislative administrative or policy measures on access and benefit-sharing">
                  <div km-textbox-ml name="title" required ng-model="document.title" locales="document.header.languages"></div>
                </div>
              </div>
            </div>


            <div class="row">
              <div class="col-xs-12">
                <div required class="km-control-group" name="status" caption="Legal status of the measure">
                  <div style="width:250px;" afc-autocomplete required name="status"  ng-model="document.status" source="options.statuses" filter="genericFilter" mapping="genericMapping" selectbox="true" placeholder="Select legal status..."></div>
                </div>
              </div>
               <div class="clearfix"></div>
              <div class="col-xs-12">
                <div ng-show="isNotLegallyBinded()">
                  <div class="km-control-group" name="adoption" required caption="Please provide the date of adoption">
                  <div km-date placeholder="YYYY-MM-DD" name="adoption" required ng-model="document.adoption"></div>
                  </div>
                </div>
                <div ng-show="isLegallyBinded()">
                  <div class="km-control-group" name="entryIntoForce" required caption="Please provide the date of entry into force">
                    <div km-date placeholder="YYYY-MM-DD" name="entryIntoForce" required ng-model="document.entryIntoForce"></div>
                  </div>
                </div>
                <div ng-show="isRetired()">
                  <div class="km-control-group" name="retired" required caption="Please provide the date from which the measure was no longer applicable">
                    <div km-date placeholder="YYYY-MM-DD" name="retired" required ng-model="document.retired">
                    </div>
                  </div>
                </div>
                <div  ng-show="isLegallyBinded() || isNotLegallyBinded()" class="km-control-group" name="limitedApplication" caption="Indicate the date the measure is no longer in force if the measure has a limited application in time" >
                  <div km-date placeholder="YYYY-MM-DD" name="limitedApplication" ng-model="document.limitedApplication"></div>
                </div>
              </div>
            </div>


            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" required name="type" caption="Type of document/measure">
                  <div km-term-radio name="type"  ng-model="document.type"
                  terms="options.typeOfDocuments()" description="true" binding-type="term" ng-click="save()" required></div>

                </div>
              </div>
            </div>
            <div class="row" ng-show="isTypeOther()">
              <div class="col-sm-12">
                  <div class="km-control-group" required name="otherTypeName" caption="Name of the other type of document/measure">
                  <div km-textbox-ml required ng-model="document.otherTypeName" locales="document.header.languages"></div>
                  </div>
              </div>
            </div>


            <div class="row">

              <div class="col-xs-12">
                <div class="km-control-group" required name="jurisdiction" caption="Area of jurisdiction">
                  <div style="width:250px;" afc-autocomplete required name="jurisdiction"  ng-model="document.jurisdiction" source="options.jurisdictions" filter="genericFilter" mapping="genericMapping" selectbox="true" placeholder="Select area of jurisdiction..."></div>
                </div>
              </div>

              <div class="col-xs-12">
                <div ng-if="isJurisdictionRegional() && !canAddRegionalMeasure()">
                  <div class="alert alert-warning"><h4>Please contact the ABS-CH (absch@cbd.int) for authorization to add Regional or Multilateral ABS Measures.</h4></div>
                </div>

                <div ng-if="isJurisdictionRegional() && canAddRegionalMeasure()">
                  <div class="km-control-group" required name="jurisdictionRegions" caption="Country name(s) and/or Geographical or political/economic group(s)">
                    <button type="button" class="btn btn-info">European Union Member States</button>
                     <!--<div  km-select required name="jurisdictionRegions" ng-model="document.jurisdictionRegions" items="options.regions()" multiple ></div>-->
                  </div>
                </div>

                <div ng-show="isJurisdictionSubNationalOrCommunity()">
                  <div class="km-control-group" required name="jurisdictionName" caption="Name of the sub-national / community / other jurisdiction">
                  <div km-textbox-ml required ng-model="document.jurisdictionName" locales="document.header.languages"></div>
                  </div>
                </div>
            </div>
            </div>


            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="description" caption="Brief description of the document including  objective and scope (max. 300 words)">
                  <div km-rich-textbox ng-model="document.description" rows="4" locales="document.header.languages"></div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="isModelContractualClause" caption="Does the measure contain model contractual clause?">
                  <div km-yes-no required ng-model="document.isModelContractualClause" locales="document.header.languages"></div>
                  <div ng-show="document.isModelContractualClause">
                    <div class="km-control-group" name="isModelContractualClauseDesc" caption="Please provide further information">
                        <div km-textbox-ml  ng-model="document.isModelContractualClauseDescription" locales="document.header.languages"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            </section>


            <section>
            <legend name="documentsDetails">Document details</legend>
            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" required name="documents" caption="Document text (in its original language)">
                  <div km-link required name="documents" ng-model="document.documents" extensions="options.documentLinksExt" allow-link="true" allow-file="true" identifier="document.header.identifier"></div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="documentTranslations" caption="Translation in one of the official UN languages">
                  <div km-link name="documentTranslations" ng-model="document.documentTranslations" extensions="options.documentTranslationsExt" allow-link="true" allow-file="true" identifier="document.header.identifier"></div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="linkedMeasures" caption="Please select any related measures">

                <div km-select multiple name="linkedMeasures" ng-model="document.linkedMeasures"items="options.measures()" placeholder="Please select ..."></div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="linkedMeasuresDescription" caption="Please describe the relationship ">
                  <div km-rich-textbox ng-model="document.linkedMeasuresDescription" rows="4" placeholder="" locales="document.header.languages"></div>
                </div>
              </div>
            </div>
            <!-- <hr>
            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="otherDocuments" caption="Any other relevant information">
                  <div km-link name="otherDocuments" ng-model="document.otherDocuments" allow-link="true" allow-file="true" identifier="document.header.identifier"></div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="otherInformation" caption="Short description">
                  <div km-textbox-ml ng-model="document.otherInformation" rows="4" placeholder="" locales="document.header.languages"></div>
                </div>
              </div>
            </div>

     -->
    </section>
          <section>
            <legend>Regulatory contact information</legend>
            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" required name="authorities" caption="Contact Institution">
                     <field-embed-contact multiple ng-model="document.authorities" locales="document.header.languages" caption="Add an institution »"></field-embed-contact>
                </div>
              </div>
            </div>
            </section>

            <section>
            <legend name="elementsOfMeasure">Elements of the measure</legend>
            <div class="help-block">
                <span ng-repeat="elm in document.absMeasures">
                    {{elm.identifier}}|
                </span>
              <label  for="absMeasures" >Please select which elements are included in the measure being registered and identify which are the relevant articles of sections of the measure for each of the selected elements.This information will assist to in displaying information on the national legal framework.
              </label>
            </div>
            <!-- // <input type="radio" name="rd_{{term.identifier}}" ng-model="identifiers[term.identifier]" autocomplete="off" value="{{term.identifier}}">
            // <input type="radio" name="rd_{{term.identifier}}" ng-model="identifiers[term.identifier]" autocomplete="off" value="{{term.identifier}}">
           -->
            <style>
              .measureChecked
              {
                background-color:#428BCA!important;
                /*//margin: 2px 2px 2px -5px;*/
                /*padding: 10px 5px 10px 5px;*/
                font-weight:bold;
              }
              .boldText{
                font-weight: bold;

              }
              .normalText{
                font-weight: normal;
              }
              .paddingleft0 {
                  background-color: #ddd;
                  margin-top:30px!important;
                  border-bottom:1px #fff solid;
                  text-transform:uppercase;

              }
              .btn-sm{
                  font-size: 10px;
              }
            </style>
            <script type="text/ng-template"  id="/app/views/forms/edit/edit-measure.directive/abs">
              <ul>
                <li ng:repeat="term in rootTerms" ng-include="'/app/views/forms/edit/edit-measure.directive/abs/inner'"></li>
              </ul>
            </script>
            <!--//  {{term.identifier}}
              // ng:if="!term.broaderTerms || (isYesNo(term.identifier) && term.level <=2) || isParentSelected(term.identifier, term.level)"> -->
            <script type="text/ng-template"  id="/app/views/forms/edit/edit-measure.directive/abs/inner">
              <div ng-class="{measureChecked : identifiers[term.identifier]}" style=""
              ng:if="!term.broaderTerms || (term.level <=2) || isParentSelected(term.identifier, term.level)">
                <table style="width:100%" cellspacing="0" cellpadding="0">
                <tr ng:class="{paddingleft0 : isMainElement(term.identifier), 'measureChecked' : identifiers[term.identifier]}" >
                  <td style="text-align:left;vertical-align:middle;" id="{{term.identifier}}_help" style="" >

                    <label for="{{term.identifier=='5B6177DD-5E5E-434E-8CB7-D63D67D5EBED' ? 'otherAbsMeasure' : term.identifier}}" name="{{term.identifier}}" >
                         &nbsp;
                         <input type="checkbox" ng-model="identifiers[term.identifier]" ng-required="IsRequired()" value="{{term.identifier}}"
                         ng:if="!isReadOnly(term.identifier) && !isYesNo(term.identifier)" />

                         <span title="{{term.description|lstring:locale}}" ng:class="{true:'boldText',false:'normalText'}[isMainElement(term.identifier) || isYesNo(term.identifier) || isSecondaryElement(term.identifier)]" style="position:relative;top:2px;">
                              <span ng-class="{'boldText':term.identifier.indexOf('5B6177DD-5E5E-434E-8CB7-D63D67D5EBED')>=0}">{{term.title||term.name | lstring:locale}} </span>
                              <i ng-show="term.description" class="icon-question-sign"></i>
                         </span>

                    </label>
                    <div class="btn-group btn-sm" ng:if="isYesNo(term.identifier)">
                      <label class="btn btn-primary btn-sm">
                        <input type="radio" ng-change="updateSelected(term, identifiers[term.identifier],'yes')" ng-model="identifiers[term.identifier]" name="rd_{{term.identifier}}"
                        ng-value="{{(term.identifier == scopeOfMeasure || (term.narrowerTerms.length||0) ==0) ? true : false}}">Yes
                      </label>
                      <label class="btn btn-primary btn-sm">
                          <input type="radio" ng-change="updateSelected(term, identifiers[term.identifier], 'no')" ng-model="identifiers[term.identifier]" name="rd_{{term.identifier}}"
                          ng-value="{{(term.identifier == scopeOfMeasure || (term.narrowerTerms.length||0) == 0) ? false : true}}"> No
                      </label>
                    </div>
                  </td>
                  <td style="text-align:left;vertical-align:middle" >
                    <span ng-if="term.identifier.indexOf('5B6177DD-5E5E-434E-8CB7-D63D67D5EBED')>=0" style="width:200px;text-align:right;vertical-align:middle">
                      <div km-textbox-ml ng-show="identifiers[term.identifier]"  style="width:200px;text-align:right;vertical-align:middle" placeholder="new element"
                       ng-model="otherCustomValues[term.identifier]" locales="locales" ng:if="!term.narrowerTerms"></div>
                      </div>
                    </span>
                  </td>
                  <td style="width:250px;text-align:right;vertical-align:middle">
                    <div ng-show="(identifiers[term.identifier] && (term.narrowerTerms.length||0) == 0) || (scopeOfMeasureTerm == term.identifier && identifiers[term.identifier]==false)"
                     km-textbox-ml ng-model="sections[term.identifier]"
                    locales="locales" ng-required="identifiers[term.identifier]" placeholder="example: Article 14.2"></div>

                    <i class="fa fa-chevron-circle-up pull-right hand" ng-click="term.showUp=!term.showUp;showHideNode(term.identifier)" ng-show="!term.showUp" ng:if="isReadOnly(term.identifier)"></i>
                    <i class="fa fa-chevron-circle-down pull-right hand" ng-click="term.showUp=!term.showUp;showHideNode(term.identifier)" ng-show="term.showUp" ng:if="isReadOnly(term.identifier)"></i>
                  </td>
                </tr>
                </table>
              </div>
              <ul style="list-style:none" id="{{term.identifier}}" >
                <li ng:repeat="term in term.narrowerTerms" ng-include="'/app/views/forms/edit/edit-measure.directive/abs/inner'" >
              </ul>
            </script>

            <div class="row">
              <div class="col-sm-12">
                <div layout="row">
                  <div style="font-weight:bold;">Check the relevant elements of the measure</div>
                  <div flex style="text-align:right;font-weight:bold;">Add reference to relevant articles and sections</div>
                </div>

               <div edit-measure-abs name="absMeasures" api="absMeasureApi" required ng-model="document.absMeasures" locales="document.header.languages"
                   document="document"></div>
              </div>
            </div>
          </section>



    <section>
            <legend>Additional information</legend>

            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="address" caption="Any other relevant information">
                  <div class="help-block">Please use this field to provide any other relevant information that may not have been addressed elsewhere in the record.</div>
                  <div km-rich-textbox ng-model="document.relevantInformation" rows="4" placeholder="" locales="document.header.languages"></div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="relevantDocuments" caption="Any other relevant documents">
                  <div km-link name="relevantDocuments" ng-model="document.relevantDocuments" allow-link="true" allow-file="true" identifier="document.header.identifier" ></div>
                </div>
              </div>
            </div>
            </section>
            <section>
            <legend>Notes</legend>
            <div class="row">
              <div class="col-sm-12">
                <div class="km-control-group" name="notes">
                  <div class="help-block">The “Notes” field is for your personal notes or comments and will be hidden when
                                            viewing the record. This field is not meant to be used for confidential information.</div>
                  <textarea class="form-control" name="notes" ng-model="document.notes" rows="4"></textarea>
                </div>
              </div>
            </div>
            </section>

          </div>
        </form>

        <div class="row" ng-show="tab=='review'" km-tab="review">
          <div class="col-xs-12">

            <div class="btn-group" ng-show="reviewDocument.header.languages.length>1">
                <input type="button" class="btn" ng-class="{'active' : review.locale==locale, 'btn-info' : review.locale==locale}" ng-repeat="locale in document.header.languages" ng-click="$parent.review.locale = locale" value="{{locale | uppercase}}" />
            </div>

            <div view-measure ng-model="reviewDocument" locale="review.locale" allow-drafts="true"></div>
          </div>
        </div>


<!--
    <hr style="margin-top:20px;">

        <div class="row" style="padding-top:20px;">
            <div class="col-xs-12">

                <div workflow-std-buttons document="getCleanDocument()" languages="document.header.languages" hide-timer="true"/>


            </div>
        </div> -->

      </div>
    </div>
  </div>
</div>
</md-content>
</div>
