<div ng-controller="myPendingTasksCotroller"  style="padding-top:20px;margin-top:20px;" class="well">

	<div class="registerpage-header">
	    <h2>
	      <span class="color-red special-font">Your pending requests</span>

	    </h2>

	    <p class="alert ">
        	Pending requests you have sent to others for approval to be published on the ABSCH.
        </p>
  	</div>
	<div class="registerpage-content">
		<div class="alert alert-danger" ng-show="__error">
			<strong>Error: </strong>{{__error}}
		</div>
		<div class="pull-right">
			<input type="text" ng-model="keywords" placeholder=" Search " class="form-control keyword" style="width:250px;display:inline;">
		</div>
		<br>
		<br>
		<table ng-show="workflows.length && !__error" class="table table-striped">
			<tr>
				<th><span style="cursor:pointer;" ng-click="sortTable('_id')">ID
             		<i ng-show="sortTerm=='_id'" ng:class="{true:'down-caret', false:'up-caret'}[orderList]"></i></th>
				<th><span style="cursor:pointer;" ng-click="sortTable('data.title.en')">Description
             		<i ng-show="sortTerm=='data.title.en'" ng:class="{true:'down-caret', false:'up-caret'}[orderList]"></i></th>
				<th><span style="cursor:pointer;" ng-click="sortTable('activities')">Status
             		<i ng-show="sortTerm=='activities'" ng:class="{true:'down-caret', false:'up-caret'}[orderList]"></i></th>
				<th><span style="cursor:pointer;" ng-click="sortTable('createdOn')">Assigned to
             		<i ng-show="sortTerm=='createdOn'" ng:class="{true:'down-caret', false:'up-caret'}[orderList]"></i></th>
			</tr>


			<tr ng-repeat="workflow in workflows|filter:keywords|orderBy:sortTerm:orderList">

				<td> <!-- ID -->
					<a style="text-transform:uppercase;white-space:nowrap;" ng-href="/register/tasks/{{workflow._id}}"  type="button">{{formatWID(workflow._id)}}</a>
					<div ng-switch="workflow.type.name">
						<em ng-switch-when="publishNationalRecord">Publishing request</em>
						<em ng-switch-when="publishReferenceRecord">Publishing request</em>
						<em ng-switch-default>*{{workflow.type.name|uppercase}}*</em>
					</div>
				</td>

				<td> <!-- Description -->
					<strong ng-show="workflow.result.documentID||workflow.data.documentID"><a ng-href="/database/record?documentID={{workflow.result.documentID||workflow.data.documentID}}">{{workflow.data.metadata.schema|schemaName}}</a></strong>
					<strong ng-hide="workflow.result.documentID||workflow.data.documentID">{{workflow.data.metadata.schema|schemaName}}</strong>

					<div>{{workflow.data.title | lstring}}</div>
				</td>

				<td> <!-- Status -->
					<div ng-repeat="activity in workflow.activities|orderBy:'createdOn'">

						<div ng-show="isOpen(activity)">
							<div ng-switch="activity.name">
								<span ng-switch-when="publishRecord"><i class="glyphicon glyphicon-time"></i> Waiting for validation</span>
								<span ng-switch-default>{{activity.name}}*</span>
							</div>
						</div>

						<div ng-hide="isOpen(activity)">
							<div ng-switch="activity.name+'-'+activity.result.action">
								<span ng-switch-when="publishRecord-approve"><i class="glyphicon glyphicon-ok"></i> Approved</span>
								<span ng-switch-when="publishRecord-reject"> <i class="glyphicon glyphicon-remove"></i> Rejected</span>
								<span ng-show="activity.result.reason"><STRONG> for {{activity.result.reason | limitTo:50}} </STRONG></span>
								<span ng-switch-when="null-null"> <i class="glyphicon glyphicon-cog"></i> Pending</span>
								<span ng-switch-default>*{{activity.name+'-'+activity.result.action}}*</span>
							</div>
						</div>
					</div>
				</td>

				<td>  <!-- Assigned to -->
					<div ng-repeat="activity in workflow.activities|orderBy:'createdOn'">

						<div ng-show="isOpen(activity)">
							<div ng-show="activity.assignedToRule">
								<div ng-switch="activity.assignedToRule|limitTo:7">
									<span ng-switch-when="ABS-NFP">ABS-CH Focal Point or Publishing Authority</span>
									<span ng-switch-when="BCH-NFP">BCH Focal Point</span>
									<span ng-switch-when="CHM-NFP">CHM Focal Point</span>
									<span ng-switch-when="BCH-Adm">SCBD</span>
									<span ng-switch-when="ABS-Adm">SCBD</span>
									<span ng-switch-when="CHM-Adm">SCBD</span>
									<span ng-switch-default>*{{activity.assignedToRule}}*</span> on {{createdOn | formatDateWithTime}}
								</div>

							</div>

							<div ng-hide="activity.assignedToRule">

								<div ng-show="activity.assignedTo">
									<span ng-repeat="user in activity.assignedTo_info|orderBy:'lastName'">
                                        {{user.firstName}} {{user.lastName}}<span ng-hide="$last">, </span>
                                         on {{createdOn | formatDateWithTime}}
								</span>

								<div ng-hide="activity.assignedTo">
									<em>Not assigned yet</em>
								</div>
							</div>

						</div>

						<div ng-hide="isOpen(activity)">
							Not assigned
						</div>

					</div>
				</td>
			</tr>
		</table>

		<div class="alert alert-success" ng-show="workflows.length==0">
			No Pending request
		</div>
	</div>
</div>
