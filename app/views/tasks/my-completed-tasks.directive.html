<div ng-controller="myCompletedTasksCotroller" class="col-xs-9" style="padding-top:20px;">
	<div>
	    <a class="pull-right" ng-show="!toggleHelp" ng-click="toggleHelp=!toggleHelp;" style="cursor:pointer;padding:5px;"><i class="glyphicon glyphicon-question-sign" >
	      </i> show help
	    </a>
	    <a class="pull-right" ng-show="toggleHelp" ng-click="toggleHelp=!toggleHelp;" style="cursor:pointer;color:#666;padding:5px;"><i class="glyphicon glyphicon-question-sign" >
	      </i> hide help
	    </a>
	</div>
	<div class="registerpage-header">
	    <h2>
	      <span class="abbreviation">My completed requests</span>	     
	    </h2>	  
  	</div>  
	<div class="registerpage-content">
		<div class="alert alert-danger" ng-show="__error">
			<strong>Error: </strong>{{__error}}
		</div>
		<div class="pull-right">
			<input type="text" ng-model="keywords" placeholder=" Search " class="form-control keyword" style="width:250px;display:inline;">
		</div>
		<br>
		<br>
		<table ng-show="workflows.length && !__error" class="table table-striped">
			<tr>
				<th><span style="cursor:pointer;" ng-click="sortTable('_id')">ID 
             		<i ng-show="sortTerm=='_id'" ng:class="{true:'down-caret', false:'up-caret'}[orderList]"></i></span>
             	</th>
				<th><span style="cursor:pointer;" ng-click="sortTable('data.title.en')">Description 
             		<i ng-show="sortTerm=='data.title.en'" ng:class="{true:'down-caret', false:'up-caret'}[orderList]"></i></span>
             	</th>
				<th><span style="cursor:pointer;" ng-click="sortTable('closedOn')">Result 
             		<i ng-show="sortTerm=='closedOn'" ng-class="{true:'down-caret', false:'up-caret'}[orderList]"></i></span>
             	</th>
			</tr>

			<tr ng-repeat="workflow in workflows|filter:keywords|orderBy:sortTerm:orderList">
				
				<td>
					<a style="text-transform:uppercase;white-space:nowrap;" ng-href="/register/tasks/{{workflow._id}}"  type="button">{{formatWID(workflow._id)}}</a>
					<div ng-switch="workflow.type.name">
						<em ng-switch-when="publishNationalRecord">Publishing request</em>
						<em ng-switch-when="publishReferenceRecord">Publishing request</em>
						<em ng-switch-default>*{{workflow.type.name|uppercase}}*</em>
					</div>
				</td>

				<td>
					<strong ng-show="workflow.result.documentID||workflow.data.documentID"><a ng-href="/database/record?documentID={{workflow.result.documentID||workflow.data.documentID}}">{{workflow.data.metadata.schema|schemaName}}</a></strong>
					<strong ng-hide="workflow.result.documentID||workflow.data.documentID">{{workflow.data.metadata.schema|schemaName}}</strong>

					<div>{{workflow.data.title | lstring}}</div>
				</td>

				<td>
					<div ng-repeat="activity in workflow.activities|orderBy:'createdOn'">

						<div ng-show="activity.completedOn">

							<span ng-show="activity" ng-switch="activity.result.action">
								<span ng-switch-when="approve"><i class="glyphicon glyphicon-ok"></i> Approved</span>
								<span ng-switch-when="reject"><i class="glyphicon glyphicon-remove"></i> Rejected</span>
								<span ng-switch-default>*{{activity.result.action}}</span>
								<span ng-show="activity.result.reason"><STRONG> for {{activity.result.reason | limitTo:50}} </STRONG></span>
							</span>
							<span> on {{activity.completedOn|date:'short'}} </span>
						</div>
						
						<div ng-show="activity.canceledOn">
							Canceled on {{activity.canceledOn|date:'short'}} 
						</div>

						<div ng-show="activity.failedOn">
							Failed on {{activity.failedOn|date:'short'}}
						</div>

					</div>

					<div ng-hide="workflow.activities">
						
						<div ng-show="workflow.completedOn">
							Compledted on {{activity.completedOn|date:'short'}}
						</div>
						
						<div ng-show="workflow.canceledOn">
							Canceled on {{activity.canceledOn|date:'short'}} 
						</div>

						<div ng-show="workflow.failedOn">
							Failed on {{activity.failedOn|date:'short'}}
						</div>

					</div>
				</td>
			</tr>
		</table>

		<div class="alert alert-success" ng-show="workflows.length==0">
			No Completed Request
		</div>
	</div>
</div>
